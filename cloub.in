include ../build_system.in

min_style       cg
thermo          1000
minimize        0.0 1.0e-8 10000 20000

velocity all create 300 61653 dist gaussian
fix nvt all nvt temp 300.0 300.0 100.0
run 10000
unfix nvt 

fix npt all npt temp 300.0 300.0 100.0 iso 0.0 0.0 100.0
dump 1 all atom 1000 npt.dump
run 100000
unfix npt

change_box all boundary p p s 
change_box all boundary p p f z delta 0.0 40
thermo_modify lost ignore
variable dz equal ramp(zlo-1,zlo)
region bottomplane plane 0 0 $(zlo-1) 0 0 1 move NULL NULL v_dz
fix wall all wall/region bottomplane lj126 $(v_epsilon*1.5) ${sigma} ${cutofflj}
fix nvt all nvt temp 300.0 300.0 100.0
run 100000
unfix wall
region bottomplane delete 

region bottomplane plane 0 0 $(zlo) 0 0 1
fix wall all wall/region bottomplane lj126 ${epsilon} ${sigma} ${cutofflj}
write_data npt.data
run 100000
unfix nvt
undump 1

region core cylinder z $((xlo+xhi)/2) $((ylo+yhi)/2) 2 EDGE EDGE
group ion region core
variable newcharge equal 6.0
fix charge ion adapt 0 atom charge v_newcharge
fix nve all nve
dump 1 all atom 1000 explo.dump
timestep 0.1
run 100000

include ../rgs_and_chgs.in
#include ../no_relax.in
include ../relax.in