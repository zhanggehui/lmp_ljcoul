reset_timestep 0
timestep 0.01

fix nve all nve
variable newcharge equal 6.0
fix charge gionized adapt 0 atom charge v_newcharge
compute charge all property/atom q
compute charge_chunk all chunk/atom c_charge compress yes
dump 1 all custom 100 explo.dump id c_charge_chunk xs ys zs
compute cylinder_chunk all chunk/atom bin/cylinder z lower $(zhi-zlo) $((xhi+xlo)/2) $((yhi+ylo)/2) 0.0 50.0 25 discard yes
fix densiyt_output all ave/chunk 1 5 10 cylinder_chunk density/mass file Density.dat
run 1 
unfix charge

variable t0 equal 20.0
variable freltime atomfile relax_random.atomfile
variable areltime atom "-v_t0*ln(v_freltime)"
#write_dump gionized custom  1.dump v_areltime
variable zerocharge equal 0.0

variable rel_astep atom v_areltime<(step*dt)
variable arelax atom (gmask(gionized))&&(v_rel_astep)
#group grelex dynamic gionized var arelax
group grelex variable arelax
fix fixrelax grelex adapt 0 atom charge v_zerocharge

variable gi_cha atom q!=0
group still_ioniz dynamic all var gi_cha
variable gi_num equal count(still_ioniz)

fix ahalt all halt 10 v_gi_num < 10 error soft
run 100000 pre no post no every 10 &
"unfix fixrelax" &
"group grelex delete" &
"group grelex variable arelax" &
"fix fixrelax grelex adapt 0 atom charge v_zerocharge"

unfix ahalt
fix fixrelax gionized adapt 0 atom charge v_zerocharge
run 1
unfix fixrelax

dump_modify 1 every 200
timestep 0.1
run 20000

dump_modify 1 every 200
timestep 0.5
run 20000

dump_modify 1 every 200
timestep 1
run 20000